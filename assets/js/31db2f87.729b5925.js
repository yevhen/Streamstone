"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[590],{2143:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"scenarios/S06_Include_additional_entities","title":"Additional Entity Includes","description":"This scenario demonstrates how to include additional entities in a stream in Streamstone.","source":"@site/docs/scenarios/S06_Include_additional_entities.md","sourceDirName":"scenarios","slug":"/scenarios/S06_Include_additional_entities","permalink":"/Streamstone/docs/scenarios/S06_Include_additional_entities","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Reading from a Stream","permalink":"/Streamstone/docs/scenarios/S05_Read_from_stream"},"next":{"title":"Custom Stream Metadata","permalink":"/Streamstone/docs/scenarios/S07_Custom_stream_metadata"}}');var i=t(4848),a=t(8453);const r={},o="Additional Entity Includes",c={},d=[];function l(n){const e={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"additional-entity-includes",children:"Additional Entity Includes"})}),"\n",(0,i.jsx)(e.p,{children:"This scenario demonstrates how to include additional entities in a stream in Streamstone."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-csharp",metastring:'title="S06_Include_additional_entities.cs"',children:'using Azure;\n\nusing System;\nusing System.Threading.Tasks;\n\nusing Azure.Data.Tables;\n\nusing Newtonsoft.Json;\n\nusing Streamstone;\n\nnamespace Example.Scenarios\n{\n    public class S06_Include_additional_entities : Scenario\n    {\n        public override async Task RunAsync()\n        {\n            var existent = await Stream.TryOpenAsync(Partition);\n\t        var stream = existent.Found ? existent.Stream : new Stream(Partition);\n\n            Console.WriteLine("Writing to new stream along with making snapshot in partition \'{0}\'", \n                              stream.Partition);\n\n            var snapshot = Include.Insert(new InventoryItemShapshot\n            {\n                RowKey = "SNAPSHOT",\n                Name = "iPhone7",\n                Count = 100 - 50 - 40,\n                Version = 5\n            });\n\n            var events = new[]\n            {\n                Event(new InventoryItemCreated(Id, "iPhone6")),\n                Event(new InventoryItemCheckedIn(Id, 100)),\n                Event(new InventoryItemCheckedOut(Id, 50)),\n                Event(new InventoryItemRenamed(Id, "iPhone6", "iPhone7")),\n                Event(new InventoryItemCheckedOut(Id, 40), snapshot)\n            };\n\n            var result = await Stream.WriteAsync(stream, events);\n\n            Console.WriteLine("Successfully written to new stream.\\r\\nEtag: {0}, Version: {1}",\n                              result.Stream.ETag, result.Stream.Version);\n        }\n\n        static EventData Event(object @event, params Include[] includes)\n        {\n            var id = Guid.NewGuid();\n\n            var properties = new\n            {\n                Type = @event.GetType().Name,\n                Data = JsonConvert.SerializeObject(@event)\n            };\n\n            return new EventData(\n                            EventId.From(id), \n                            EventProperties.From(properties), \n                            EventIncludes.From(includes));\n        }\n\n        class InventoryItemShapshot : ITableEntity\n        {\n            public string PartitionKey { get; set; }\n\n            public string RowKey { get; set; }\n\n            public DateTimeOffset? Timestamp { get; set; }\n\n            public ETag ETag { get; set; }\n\n            public string Name { get; set; }\n\n            public int Count { get; set; }\n\n            public int Version { get; set; }\n        }\n    }\n}\n'})})]})}function u(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>o});var s=t(6540);const i={},a=s.createContext(i);function r(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);